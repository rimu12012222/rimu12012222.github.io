<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>クリックして開始</title>

    <link rel="preload" href="style.css" as="style">

    <link rel="preload" href="images/background.jpg" as="image">

    <link rel="preload" href="music/bgm.mp3" as="audio">

    <style>
        /* body全体を使い、要素を中央に配置 */
        body {
            margin: 0;
            padding: 0;
            display: flex; /* Flexboxを使って子要素を配置 */
            justify-content: center; /* 水平方向の中央寄せ */
            align-items: center; /* 垂直方向の中央寄せ */
            min-height: 100vh; /* 画面の高さいっぱいにする */
            background-color: #f0f0f0; /* 背景色（任意、画像が表示されない場合のFallback） */
            cursor: pointer; /* クリック可能であることを示すカーソル */
            user-select: none; /* テキスト選択を無効に（任意） */
            -webkit-user-select: none; /* Safari対応 */
            -ms-user-select: none; /* IE対応 */
            touch-action: manipulation; /* タッチ操作の最適化 */
            position: relative; /* ::before要素（オーバーレイ）の基準点とするために必要 */
            /* overflow: hidden; */ /* 意図しないスクロールバーを非表示にしたい場合など */

            /* ★メインページ（main.html）の背景スタイルを移植します★ */
            background-image: url('images/background.jpg'); /* ← ここをあなたのメインページの背景画像への正しいパスに修正してください */
            background-size: cover; /* 画面全体を覆うように画像を拡大縮小 */
            background-repeat: no-repeat; /* 画像を繰り返さない */
            background-position: center center; /* 画像を中央に配置 */
            background-attachment: fixed; /* スクロールしても画像は固定 */
        }

        /* 背景画像を調整するための半透明オーバーレイ */
        body::before {
            content: ''; /* 疑似要素には content が必要 */
            position: absolute; /* bodyを基準に絶対配置 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* 白の半透明色でオーバーレイをかけます - 見え方を調整 */
            background-color: rgba(255, 255, 255, 0.9); /* 白を90%の透明度で重ねる（背景は10%だけ見える） */
            z-index: 1; /* クリックを促す文字より手前に表示（ただし文字はさらにz-indexを高くする） */
        }


        /* Sahitya-Regular.ttf フォントの定義 */
        @font-face {
            font-family: 'SahityaRegular'; /* フォント名を 'SahityaRegular' に設定 */
            /* ★ここに、あなたが持っている Sahitya-Regular.ttf のフォントファイルへのパスを指定してください★ */
            src: url('font/Sahitya-Regular.ttf') format('truetype'); /* パスとフォーマットを設定 */
            /* 複数の形式（woff2, woff, ttfなど）を指定すると、より多くのブラウザで表示できます */

            font-weight: normal;
            font-style: normal;
        }


        /* クリックを促す文字のスタイル */
        .click-prompt {
            font-family: 'SahityaRegular', sans-serif; /* SahityaRegular フォントを使用 */
            font-size: 2.5em; /* 文字サイズ */
            color: #88ccff; /* 薄い水色 */
            text-align: center;
            /* 外枠はなし */
            /* text-shadow: ... */
            /* -webkit-text-stroke: ... */
            /* text-stroke: ... */

            /* 文字の太さや凝縮はフォントファイル（Sahitya-Regular.ttf）のデザインに依存します */
            /* font-weight: normal; */ /* Sahitya-Regular自体のウェイトを使用 */

            position: relative;
            z-index: 2;
        }

    </style>
</head>
<body>

    <div class="click-prompt">
        click
    </div>

    <audio id="silent-audio" src="music/silent.mp3" preload="auto"></audio> <script>
        var silentAudioPlayed = false; // 無音オーディオが再生されたかを示すフラグ

        // メインページへの遷移と、スマホ向けオーディオアンロックを試みる関数
        function goToMainPage() {
            // スマホ向け対策：ユーザー操作をトリガーに無音オーディオを再生し、オーディオ再生を「アンロック」する
            // まだ無音オーディオを再生していなければ試みる
            if (!silentAudioPlayed) {
                var silentAudio = document.getElementById('silent-audio');
                // play() は Promise を返すので、then() や catch() で成功/失敗を検知できます
                var playPromise = silentAudio.play();

                if (playPromise !== undefined) {
                    playPromise.then(function() {
                        console.log('Silent audio played successfully. Attempting to unlock audio.');
                        silentAudioPlayed = true;

                        // 無音再生に成功したら、少し待ってからメインページへ遷移
                        // 少し待つことで、ブラウザがオーディオ再生を許可した状態になるのを期待します
                        setTimeout(function() {
                            console.log('Redirecting to main page after silent audio.');
                            window.location.href = 'main.html'; // main.html にリダイレクト
                        }, 100); // 例: 100ミリ秒待つ（この時間は調整してみてください。短すぎると効果がない場合があります）

                    }).catch(function(error) {
                        console.log('Silent audio playback prevented or failed:', error);
                        // 無音再生が失敗した場合でも、そのままメインページへ遷移を試みる
                         console.log('Redirecting to main page after silent audio failure.');
                        window.location.href = 'main.html'; // main.html にリダイレクト
                    });
                } else {
                    // play() が Promise を返さない場合（古いブラウザなど）、すぐにリダイレクト
                    console.log('play() did not return a Promise. Redirecting directly.');
                    window.location.href = 'main.html'; // main.html にリダイレクト
                }

            } else {
                // 無音オーディオが既に再生されていれば、そのままメインページへ遷移
                 console.log('Silent audio already played. Redirecting to main page.');
                 window.location.href = 'main.html'; // main.html にリダイレクト
            }

             // イベントリスナーを一度削除して、複数回呼ばれないようにする
             // リダイレクト処理の直前に削除
            removeInteractionListeners();
        }

         // イベントリスナーを削除する関数
        function removeInteractionListeners() {
            // body要素に対するリスナーを削除
            document.body.removeEventListener('click', handleInteraction);
            document.body.removeEventListener('touchstart', handleInteraction);
            console.log('Interaction listeners removed from body.');
        }

        // クリックまたはタッチが発生したときに呼び出される関数
        function handleInteraction(event) {
             console.log('Interaction detected:', event.type);

             // ここで preventDefault() を呼び出すと、スマホでのタップ時のハイライトなどを防げますが、
             // 意図しない副作用がある場合もあるため、ここでは呼び出しません。
             // event.preventDefault(); // 必要であればコメント解除して試してみてください

             // ユーザー操作を検知したら、メインページ遷移とオーディオアンロック処理に進む
             goToMainPage();
        }


        // ページ上のユーザーインタラクション (クリックまたはタッチ) を検知するためのイベントリスナーを body に追加
        // これらのイベントのいずれかが最初に発生したときにhandleInteractionが実行される
        // body 要素にリスナーを追加することで、クリック待ち画面のどこをタップ・クリックしても反応するようにします
        document.body.addEventListener('click', handleInteraction); // クリックイベント (PCなど)
        document.body.addEventListener('touchstart', handleInteraction); // タッチイベント (スマートフォンなど)

        console.log('Interaction listeners added to body.');


    </script>

</body>
</html>